<!DOCTYPE html>

<html>
    <head>
        <title>Emotion Detection System</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="icon" href="images/favicon.png" />
        <link href="bootstrap-5.3.0-alpha3-dist/css/bootstrap.min.css" rel="stylesheet" />
    </head>

    <body class="p-2">
        <h2>Emotion Detection System</h2>

        <ul class="nav nav-underline">
            <li class="nav-item">
                <a id="image-tab-item" class="nav-link active" href="#" onclick="navTo('image')">Image</a>
            </li>

            <li class="nav-item">
                <a id="webcam-tab-item" class="nav-link" href="#" onclick="navTo('webcam')">Webcam</a>
            </li>
        </ul>

        <!-- <div class="card mt-2 mb-3 shadow-sm">
            <img id="input-image" class="card-img-top" style="object-fit: scale-down; max-height: 512px" src="images/placeholder.png" alt="Image" />

            <div class="card-body">
                <label class="card-title form-label fw-bold">Upload an image</label>
                <input class="form-control" type="file" id="imageFile" accept="image/*" onchange="uploadImage(this)" />
            </div>
        </div> -->

        <div class="card mt-2 mb-3 shadow-sm">
            <video id="input-webcam" autoplay="true"></video>

            <div class="card-body">
                <label class="card-title form-label fw-bold">Upload an image</label>
                <input class="form-control" type="file" id="imageFile" accept="image/*" onchange="uploadImage(this)" />
            </div>
        </div>

        <script src="bootstrap-5.3.0-alpha3-dist/js/bootstrap.bundle.min.js"></script>

        <script>
            const inputWebcam = document.getElementById("input-webcam")

            if (navigator.mediaDevices.getUserMedia) {
                (async () => {
                    try {
                        inputWebcam.srcObject = await navigator.mediaDevices.getUserMedia({ video: true })
                    } catch {
                        console.log("Failed to load from webcam")
                    }
                })()
            } else console.log("Get user media is not supported")

            function uploadImage(input) {
                if (!input.files || !input.files[0]) return

                if (!input.files[0]["type"].startsWith("image/")) {
                    alert("File chosen is not an image")
                    input.value = ""
                    return
                }

                const reader = new FileReader()

                reader.onload = async e => {
                    document.getElementById("input-image").setAttribute("src", e.target.result)
                    console.log(await fetch("/detect_emotions", { method: "POST" }))
                }

                reader.readAsDataURL(input.files[0])
            }

            function navTo(route) {
                document.getElementById("image-tab-item").className = "nav-link"
                document.getElementById("webcam-tab-item").className = "nav-link"

                switch (route) {
                    case "image":
                        document.getElementById("image-tab-item").className = "nav-link active"
                        break

                    case "webcam":
                        document.getElementById("webcam-tab-item").className = "nav-link active"
                }
            }
        </script>
    </body>
</html>
